/*! market 2018-03-12 */

angular.module("common.advanced",["ui.bootstrap"]),angular.module("common.advanced").directive("advancedData",function(t){return{restrict:"E",scope:{name:"@",beforeData:"=",afterData:"=",mainData:"=",mainDataChinese:"=",type:"@"},template:'\t\t\t\t<div class="col-sm-3">\t\t\t\t\t<div class="dropdown beforeSheetData">\t\t\t\t\t\t<ul class="dropdown-menu">\t\t\t\t\t\t\t<li ng-repeat="data in beforeData" ng-dblclick="toUp()" id="{{data.tableid}}" ng-bind="data.tablenamecn"></li>\t\t\t\t\t\t</ul>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div class="col-sm-1 text-center">\t\t\t\t\t<p ng-click="toUp()" title="选中"><span class="glyphicon glyphicon-chevron-right"></span></p>\t\t\t\t\t<p ng-click="toBack()" title="取消"><span class="glyphicon glyphicon-chevron-left"></span></p>\t\t\t\t\t<p ng-click="toUpAll()" title="全部选中"><span class="glyphicon glyphicon-forward"></span></p>\t\t\t\t\t<p ng-click="toBackAll()" title="全部取消"><span class="glyphicon glyphicon-backward"></span></p>\t\t\t\t</div>\t\t\t\t<div class="col-sm-3">\t\t\t\t\t<div class="dropdown afterSheetData">\t\t\t\t\t\t<ul id="outer_wrap" class="dropdown-menu"></ul>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t',controller:function(t,e,a){function o(e,a){for(var o=0;o<t.afterData.length;o++)if(t.afterData[o].tableId==e)return beforeDataZN=Torch.tableCols.getName(e),Torch.info("已选该数据:"+beforeDataZN,"danger"),!1;return!0}t.backData=function(){t.afterDataNum=t.afterDataNum+1,t.afterData=[];for(var e=0;e<$("#outer_wrap li").length;e++)"cols"==t.type?t.afterData.push({colName:$("#outer_wrap li")[e].id,tableNameCn:$("#outer_wrap li")[e].innerHTML,tableId:$("#outer_wrap li")[e].getAttribute("name")}):t.afterData.push({tableId:$("#outer_wrap li")[e].id,tableNameCn:$("#outer_wrap li")[e].innerHTML,mainData:$("#outer_wrap li")[e].getAttribute("name")})},t.toUp=function(){for(var e=0;e<$(".beforeSheetData .backgroundBlue").length;e++){var a=Torch.tableCols.getName(t.mainData);o($(".beforeSheetData .backgroundBlue")[e].id)&&$("#outer_wrap").append("<li class='outerWrap' name='"+t.mainData+"' id='"+$(".beforeSheetData .backgroundBlue")[e].id+"'><span style='color:blue;'>[ "+a+" ] </span>"+$(".beforeSheetData .backgroundBlue")[e].innerHTML+"</li>")}$(".dropdown li").removeClass("backgroundBlue"),t.backData(),$(".outerWrap").click(function(t){t.shiftKey?$(this).toggleClass("backgroundBlue"):($(".outerWrap").attr("class",""),$(this).addClass("backgroundBlue"))}),$(".outerWrap").dblclick(function(e){$("#outer_wrap li").remove(".backgroundBlue"),$(".dropdown li").attr("class",""),t.backData()})},t.toUpAll=function(){for(var e=0;e<$(".beforeSheetData li").length;e++){var a=Torch.tableCols.getName(t.mainData);o($(".beforeSheetData li")[e].id)&&$("#outer_wrap").append("<li class='outerWrap' name='"+t.mainData+"' id='"+$(".beforeSheetData li")[e].id+"'><span style='color:blue;'>[ "+a+" ] </span>"+$(".beforeSheetData li")[e].innerHTML+"</li>")}$(".dropdown li").removeClass("backgroundBlue"),t.backData(),$(".outerWrap").click(function(t){t.shiftKey?$(this).toggleClass("backgroundBlue"):($(".outerWrap").attr("class",""),$(this).addClass("backgroundBlue"))}),$(".outerWrap").dblclick(function(e){$("#outer_wrap li").remove(".backgroundBlue"),$(".dropdown li").attr("class",""),t.backData()})},t.toBack=function(){$("#outer_wrap li").remove(".backgroundBlue"),$(".dropdown li").attr("class",""),t.backData()},t.toBackAll=function(){$("#outer_wrap li").remove(),t.backData()},t.afterDataNum=0,t.$watch("afterData",function(e,o,n){if(!(e.length!=o.length&&o.length>0)&&0==t.afterDataNum&&e.length>0){t.afterDataNum=t.afterDataNum+1;for(var r=0;r<t.afterData.length;r++)if("cols"==t.type){var l=Torch.tableCols.getName(t.afterData[r].tableId);if(!t.afterData[r].colNameCn)return void(t.afterDataNum=t.afterDataNum-1);$("#outer_wrap").append("<li name='"+t.afterData[r].tableId+"' id='"+t.afterData[r].colName+"'><span style='color:blue;'>[ "+l+" ] </span>"+t.afterData[r].colNameCn+"</li>")}else{var i=t.afterData[r].themeName||themeId;$("#outer_wrap").append("<li id='"+t.afterData[r].tableId+"'><span style='color:blue;'>[ "+i+" ] </span>"+t.afterData[r].tableNameCn+"</li>")}$("#outer_wrap li").click(function(t){t.shiftKey?$(this).toggleClass("backgroundBlue"):($(".outerWrap").attr("class",""),$(this).addClass("backgroundBlue"))}),$("#outer_wrap li").dblclick(function(e){$("#outer_wrap li").remove(".backgroundBlue"),$(".dropdown li").attr("class",""),t.backData()}),"cols"==t.type&&t.backData(),a(function(){function e(t){return{x:t.pageX||t.clientX+document.body.scrollLeft,y:t.pageY||t.clientY+document.body.scrollTop}}function a(t){return{x:t.offsetParent?t.offsetLeft+arguments.callee(t.offsetParent).x:t.offsetLeft,y:t.offsetParent?t.offsetTop+arguments.callee(t.offsetParent).y:t.offsetTop}}function o(t){return{width:t.offsetWidth,height:t.offsetHeight}}document.onselectstart=function(){return!1};var n={};n.isMove=!1;var r=document.createElement("div");r.style.width="400px",r.style.height="1px",r.style.fontSize="0",r.style.background="red";var l=function(t){return document.getElementById(t)}("outer_wrap");l.onmousedown=function(i){for(var c=l.getElementsByTagName("li"),u=0;u<c.length;u++)c[u].pos=a(c[u]),c[u].size=o(c[u]);var s=(i=i||window.event).target||i.srcElement;if("li"==s.tagName.toLowerCase()){var d=e(i),f=s.cloneNode(!0);f.style.position="absolute",f.style.left=s.pos.x+"px",f.style.top=s.pos.y+"px",f.style.width=s.size.width+"px",f.style.height=s.size.height+"px",f.style.border="1px solid #d4d4d4",f.style.background="#d4d4d4",f.style.opacity="0.7",document.body.appendChild(f),document.onmousemove=function(t){var a=e(t=t||window.event);f.style.left=s.pos.x+a.x-d.x+"px",f.style.top=s.pos.y+a.y-d.y+"px";for(var o=0;o<c.length;o++)a.x>c[o].pos.x&&a.x<c[o].pos.x+c[o].size.width&&a.y>c[o].pos.y&&a.y<c[o].pos.y+c[o].size.height/2?s!=c[o]&&(n.isMove=!0,l.insertBefore(r,c[o])):a.x>c[o].pos.x&&a.x<c[o].pos.x+c[o].size.width&&a.y>c[o].pos.y+c[o].size.height/2&&a.y<c[o].pos.y+c[o].size.height&&s!=c[o]&&(n.isMove=!0,l.insertBefore(r,c[o].nextSibling))},document.onmouseup=function(e){e=e||window.event,document.onmousemove=null,n.isMove&&(l.replaceChild(s,r),n.isMove=!1),document.body.removeChild(f),f=null,document.body.style.cursor="normal",document.onmouseup=null,t.backData()}}}},500)}})},link:function(t,e,a){t.$watch("beforeData",function(t,e,a){t&&$(".dropdown li").click(function(t){t.shiftKey?$(this).toggleClass("backgroundBlue"):($(".dropdown li").attr("class",""),$(this).addClass("backgroundBlue"))})})}}}),angular.module("common.cascade",[]),angular.module("common.cascade").directive("cascade",function(){return{restrict:"EA",scope:{data:"=",one:"=",two:"=",three:"=",city:"@",cascadeRule:"@"},template:function(t,e){if(e.three)a="col-sm-4";else var a="col-sm-6";var o="";return e.one&&(o+='<div class="'+a+' no-horizontal-padding"><select class="form-control" ng-model="one" ng-change="setTwoData(one)" rule="{{cascadeRule}}"><option ng-repeat="item in onedata" ng-bind="item.text" value="{{item.value}}"></option></select></div>'),e.two&&(o+='<div class="'+a+'"><select class="form-control" ng-model="two" ng-change="setThreeData(two)" rule="{{cascadeRule}}"><option ng-repeat="item in twodata" ng-bind="item.text" value="{{item.value}}"></option></select></div>'),e.three&&(o+='<div class="'+a+' no-horizontal-padding"><select class="form-control" ng-model="three" rule="{{cascadeRule}}"><option ng-repeat="item in threedata" ng-bind="item.text" value="{{item.value}}"></option></select></div>'),o},controller:function(t,e,a){},link:function(t,e,a){function o(t){return t||[]}function n(e){var a=t.onedata;if(!e)return[];if(""==e)return[];if(a)for(var o=0,n=a.length;o<n;o++){var r=a[o];if(r.value&&r.value==e)return r.child||[]}return[]}function r(e){var a=t.twodata;if(!e)return[];if(""==e)return[];if(a)for(var o=0,n=a.length;o<n;o++){var r=a[o];if(r.value&&r.value==e)return r.child||[]}return[]}function l(e){t.two="",a.three&&(t.three="")}function i(e){a.three&&(t.three="")}t.getOneData=o,t.getTwoData=n,t.getThreeData=r,t.setTwoData=l,t.setThreeData=i,t.$watch("one",function(t,e,a){a.twodata=a.getTwoData(t)}),a.three&&t.$watch("two",function(t,e,a){a.threedata=a.getThreeData(t)}),void 0!==a.city&&(t.onedata=Torch.city.getAll(),t.twodata=t.getTwoData(t.one),a.three&&(t.threedata=t.getThreeData(t.two))),void 0!==a.data&&t.$watch("data",function(t,e,o){o.onedata=o.getOneData(t),o.twodata=o.getTwoData(o.one),a.three&&(o.threedata=o.getThreeData(o.two))})}}}),angular.module("common.data",[]),angular.module("common.data").filter("dict",function(){return function(t,e){if(!e)return"";if("object"==typeof e)var a=e[t]||"";else a="string"==typeof e?Torch.dict.getText(e,t):"";return a}}),angular.module("common.data").filter("value",function(){return function(t,e){if(console.log(e),!e){for(var a in t)if("("==t[a]){var o=t.substring(0,a);console.log(t.substring(0,a))}return o}}}),angular.module("common.data").filter("timeDate",function(){return function(t){if(t)var e=t.substring(0,10);return e}}),angular.module("common.data").filter("codePreview",function(){return function(t){return isNaN(t)?Torch.tableCols.getName(t):t}}),angular.module("common.data").filter("codePreviews",function(){return function(t){if(isNaN(t)){var e=Torch.tableCols.getName(t);return e==t?t:e+"--"+t}return t}}),angular.module("common.data").filter("milliseconds",function(){return function(t){return t?new Date(t).toLocaleString():""}}),angular.module("common.data").filter("oprFilter",function(){return function(t){return 1==t?"等于":2==t?"大于":3==t?"小于":4==t?"大于等于":5==t?"小于等于":6==t?"包含":7==t?"匹配开头":8==t?"匹配结尾":9==t?"模糊匹配":t}}),angular.module("common.data").filter("weekFile",function(){return function(t){return 1==t?"星期一":2==t?"星期二":3==t?"星期三":4==t?"星期四":5==t?"星期五":6==t?"星期六":7==t?"星期七":t}});